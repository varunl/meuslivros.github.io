<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Requesting authorization</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="section" title="Requesting authorization"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec24"/>Requesting authorization</h1></div></div></div><p>We'll assume that the<a id="id194" class="indexterm"/> client application is already registered with the authorization server, and the client developer gets the required data from the server, such as authorization endpoint and client identification.</p><p>The client application constructs the request, using the specified endpoint and the needed parameters and, for example, we may have the following form:</p><p>
<code class="literal">https://api.example-service.com/oauth/authorize?response_type=token&amp;client_id=CLIENT_ID_EXAMPLE&amp;redirect_uri=REDIRECT_ENDPOINT_EXAMPLE</code>
</p><p>The parameters that are used <a id="id195" class="indexterm"/>when constructing the request are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">response_type</code>: <a id="id196" class="indexterm"/>This is a mandatory parameter, and its value must be set to <code class="literal">token</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">client_id</code>: <a id="id197" class="indexterm"/>This is a mandatory parameter used for client identification</li><li class="listitem" style="list-style-type: disc"><code class="literal">redirect_uri</code>: <a id="id198" class="indexterm"/>This is an optional parameter that represents the redirection endpoint used by the authorization server to return the access token if the authorization was approved by the user</li><li class="listitem" style="list-style-type: disc"><code class="literal">scope</code>: <a id="id199" class="indexterm"/>This is an optional parameter</li><li class="listitem" style="list-style-type: disc"><code class="literal">state</code>: This is an<a id="id200" class="indexterm"/> optional parameter</li></ul></div><p>The <code class="literal">scope</code> and <code class="literal">state</code> parameters were discussed in <a class="link" href="ch04.html" title="Chapter&#xA0;4.&#xA0;OAuth for Web Server Applications">Chapter 04</a>, <span class="emphasis"><em>OAuth for Web Server Applications</em></span>, so you can refer to that chapter if they aren't clear already.</p><p>With the request constructed, the client application redirects the end user to it. The authorization server checks whether all the parameters are valid. The end user is authenticated and is asked for a decision whether to allow the authorization request or not.</p><p>As in the authorization code grant,<a id="id201" class="indexterm"/> the user is asked for a decision whether to allow or deny the request.</p><div class="section" title="Successful authorization"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec24"/>Successful authorization</h2></div></div></div><p>When the user approves the request,<a id="id202" class="indexterm"/> the server will do a redirect to the specified redirection endpoint and in response the access token will be contained as well.</p><p>For example, the response may have the following form:</p><p>
<code class="literal">https://client.example.com/oauth/cb#access_token=ACCESS_TOKEN_VALUE&amp;expires_in=3600</code>
</p><p>The first thing we notice is that the OAuth 2.0 related parameters are part of the fragment of the URL as they are after the hash (<code class="literal">#</code>) symbol. This is important to know because in the client application's code the developer may have to implement a different way of getting the values for the parameters.</p><p>URL fragments mean that all the parameters after the hash symbol are used only by the browser (that is used by the client-side (JavaScript) code that we have written and is executed in the browser) and these parameters are not sent to a server.</p><p>The parameters that can be included in the fragment are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">access_token</code>: <a id="id203" class="indexterm"/>This is a mandatory parameter. Its value is the actual access token that the client application requires.</li><li class="listitem" style="list-style-type: disc"><code class="literal">expires_in</code>: <a id="id204" class="indexterm"/>This is an optional and recommended parameter. It specifies the lifetime of the access token in seconds.</li><li class="listitem" style="list-style-type: disc"><code class="literal">token_type</code>: <a id="id205" class="indexterm"/>This is a mandatory parameter as defined in the specifications, but in real life scenarios it can be found omitted from the response. Token type specifies what kind of a token is returned in the response and it may be utilized when implementing a client application against an authorization server with some additional security.</li><li class="listitem" style="list-style-type: disc"><code class="literal">scope</code>: This is an optional parameter.</li><li class="listitem" style="list-style-type: disc"><code class="literal">state</code>: This is a mandatory parameter in the response. If it was used when making the request, it will return the same value that was supplied then.</li></ul></div><p>Another key difference compared to the authorization code grant is that, in an implicit grant, refresh tokens are not issued to the client application. When the access token expires the client has to initiate the whole<a id="id206" class="indexterm"/> implicit grant flow again.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip13"/>Tip</h3><p>The OAuth 2.0 specification does not define how many characters long the access tokens should be.</p></div></div></div><div class="section" title="Authorization error"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec25"/>Authorization error</h2></div></div></div><p>If the request was denied<a id="id207" class="indexterm"/> by the user, or <code class="literal">redirect_uri</code> is missing or invalid, or <code class="literal">client_id</code> is missing or invalid, the client applications will get an error response from the server.</p><p>For example, the error response can be in the following form:</p><p>
<code class="literal">https://client.example.com/oauth/cb?error=access_denied&amp;state=APP_STATE</code>
</p><p>The parameters are the same as in the error response in the authorization code grant, but let's take a look at them again.</p><p>The most important is the <code class="literal">error</code> parameter, <a id="id208" class="indexterm"/>which can contain one of the following values, depending on what the cause of the error was:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">invalid_request</code>: <a id="id209" class="indexterm"/>This error occurs when there's a problem with the request such as a missing parameter or value, a parameter included more than once, or a parameter with a malformed name.</li><li class="listitem" style="list-style-type: disc"><code class="literal">unauthorized_client</code>: <a id="id210" class="indexterm"/>This error occurs when the client application was not authorized, or most probably the <code class="literal">client_id</code> parameter is invalid.</li><li class="listitem" style="list-style-type: disc"><code class="literal">access_denied</code>: <a id="id211" class="indexterm"/>This error occurs when the end user (the resource owner) has denied the request.</li><li class="listitem" style="list-style-type: disc"><code class="literal">unsupported_response_type</code>: <a id="id212" class="indexterm"/>This error occurs when the authorization server cannot support the requested response. If in the request the <code class="literal">response_type</code> parameter is set to <code class="literal">code</code>, this won't happen.</li><li class="listitem" style="list-style-type: disc"><code class="literal">invalid_scope</code>: This error occurs when the scope specified does not exist or is invalid.</li><li class="listitem" style="list-style-type: disc"><code class="literal">server_error</code>: This error occurs when an unknown error happened and the server cannot process the response. It is very similar to HTTP 500 errors in web pages.</li><li class="listitem" style="list-style-type: disc"><code class="literal">temporarily_unavailable</code>: <a id="id213" class="indexterm"/>This error occurs when the authorization server cannot process the request at the given moment.</li></ul></div><p>Additional parameters that the<a id="id214" class="indexterm"/> response may include are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">error_description</code>:<a id="id215" class="indexterm"/> This is an optional parameter; it may contain a message describing what was the error cause</li><li class="listitem" style="list-style-type: disc"><code class="literal">error_uri</code>: <a id="id216" class="indexterm"/>This is an optional parameter, containing a URI to a web document that should contain an additional description of the error</li><li class="listitem" style="list-style-type: disc"><code class="literal">state</code>: This<a id="id217" class="indexterm"/> is a mandatory parameter that returns the exact value that was specified in the request with the same-named <code class="literal">state</code> parameter</li></ul></div></div></div></body></html>
