<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OAuth 2.0 SAML assertions for client authentication</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="section" title="OAuth 2.0 SAML assertions for client authentication"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec42"/>OAuth 2.0 SAML assertions for client authentication</h1></div></div></div><p>When using one of the grants defined in OAuth 2.0, SAML assertions<a id="id434" class="indexterm"/> can be used for providing client authentication. When the authorization server processes the access token request in a given grant flow, it will check whether the client's credentials are valid based on the assertion, and then the client will be authorized to make the request.</p><p>The structure of the assertion XML is the same as in the previous case, with the difference that it's not used in exchange for an access token; it's purpose is to provide client identification information.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip26"/>Tip</h3><p>When using assertions for client authentication, the way the assertion is obtained from the SAML identity provider is not part of the specification and may differ between implementations, so always check the developer documentation provided for the given provider.</p></div></div><div class="section" title="Requesting the access token"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec57"/>Requesting the access token</h2></div></div></div><p>We will make a request for the <a id="id435" class="indexterm"/>access token using the authorization code grant from the point where the client application has already requested and obtained the authorization code and will request the access token next.</p><p>The endpoint with the required parameters<a id="id436" class="indexterm"/> may have the following form:</p><p>
<code class="literal">https://example-service.com/oauth/token?grant_type=authorization_code&amp;code=AUTHORIZATION_CODE_VALUE&amp;client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Asaml2-bearer&amp;assertion=AssertionToBase64Url</code>
</p><p>The parameters that are used <a id="id437" class="indexterm"/>when constructing the request are the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">grant_type</code>: <a id="id438" class="indexterm"/>This is a mandatory parameter, in our example <code class="literal">authorization_code</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">client_assertion</code>:<a id="id439" class="indexterm"/> This is a mandatory parameter containing a single SAML 2.0 assertion encoded with the base64url method</li><li class="listitem" style="list-style-type: disc"><code class="literal">client_assertion_type</code>: <a id="id440" class="indexterm"/>This is a mandatory parameter, always set to <code class="literal">urn:ietf:params:oauth:client-assertion-type:saml2-bearer</code></li></ul></div><p>Next, we check the parameters from the chosen grant, so in our case additional parameters in the request are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">code</code>: <a id="id441" class="indexterm"/>This is the authorization code previously retrieved from the authorization server</li><li class="listitem" style="list-style-type: disc"><code class="literal">redirect_uri</code>: <a id="id442" class="indexterm"/>This is where the authorization server should redirect the client and supply the access token</li><li class="listitem" style="list-style-type: disc"><code class="literal">client_id</code>:<a id="id443" class="indexterm"/> This is an optional parameter, used for client identification</li><li class="listitem" style="list-style-type: disc"><code class="literal">client_secret</code>: This<a id="id444" class="indexterm"/> is an optional parameter, used for client identification</li></ul></div></div><div class="section" title="Authentication error"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec58"/>Authentication error</h2></div></div></div><p>If the assertion is not<a id="id445" class="indexterm"/> valid, for any reason,<a id="id446" class="indexterm"/> the authorization server returns a response containing information regarding the error:</p><div class="informalexample"><pre class="programlisting">{
  "error":"invalid_client"
}</pre></div><p>The value of the <code class="literal">error</code> parameter in this case will always be <code class="literal">invalid_client</code>. Optionally, the parameters <code class="literal">error_message</code> and <code class="literal">error_uri</code> may be included.</p><p>Note that the validation of the<a id="id447" class="indexterm"/> assertion is the same as<a id="id448" class="indexterm"/> in the previous case.</p></div></div></body></html>
