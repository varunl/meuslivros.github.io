<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter&#xA0;3.&#xA0;Setting up the Kafka Cluster</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="chapter" title="Chapter&#xA0;3.&#xA0;Setting up the Kafka Cluster"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter&#xA0;3.&#xA0;Setting up the Kafka Cluster</h1></div></div></div><p>Now we are ready to play with the Apache Kafka <a id="id28" class="indexterm"/>publisher-based messaging system.</p><p>With Kafka, we can create multiple types of clusters, such as the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Single node &#x2013; single broker cluster</li><li class="listitem" style="list-style-type: disc">Single node &#x2013; multiple broker cluster</li><li class="listitem" style="list-style-type: disc">Multiple node &#x2013; multiple broker cluster</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>All the commands and cluster setups in this chapter are based on Kafka 0.8.</p></div></div><p>With Kafka 0.8<a id="id29" class="indexterm"/>, replication of clusters can also be established, which will be discussed in brief in the last part of this chapter.</p><p>So let's start with the basics.</p><div class="section" title="Single node &#x2013; single broker cluster"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec13"/>Single node &#x2013; single broker cluster</h1></div></div></div><p>This is the<a id="id30" class="indexterm"/> starting point of learning Kafka. In the previous chapter, we built and installed Kafka on a single machine. Now it is time to setup single node &#x2013; single broker based Kafka cluster as shown in the following diagram</p><div class="mediaobject"><img src="graphics/7938OS_03_01.jpg" alt="Single node &#x2013; single broker cluster"/></div><div class="section" title="Starting the ZooKeeper server"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec09"/>Starting the ZooKeeper server</h2></div></div></div><p>Kafka provides the<a id="id31" class="indexterm"/> default and simple ZooKeeper configuration file used for launching a single local ZooKeeper instance. Here, ZooKeeper serves as the coordination interface between the Kafka broker and consumers. The Hadoop overview given on the Hadoop Wiki site is as follows (<a class="ulink" href="http://wiki.apache.org/hadoop/ZooKeeper/ProjectDescription">http://wiki.apache.org/hadoop/ZooKeeper/ProjectDescription</a>):</p><div class="blockquote"><blockquote class="blockquote"><p>"ZooKeeper (<a class="ulink" href="http://zookeeper.apache.org">http://zookeeper.apache.org</a>) <a id="id32" class="indexterm"/>allows distributed processes coordinating with each other through a shared hierarchical name space of data registers <a id="id33" class="indexterm"/>(<span class="strong"><strong>znodes</strong></span>), much like a file system. </p><p>The main differences between ZooKeeper and standard filesystems<a id="id34" class="indexterm"/> are<a id="id35" class="indexterm"/> that every znode can have data associated with it and znodes are limited to the amount of data that they can have. ZooKeeper was designed to store coordination data: status information, configuration, location information, and so on."</p></blockquote></div><p>First start the <a id="id36" class="indexterm"/>ZooKeeper using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]# bin/zookeeper-server-start.sh config/zookeeper.properties</strong></span>
</pre></div><p>You should get an output as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7938OS_03_02.jpg" alt="Starting the ZooKeeper server"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>Kafka comes with the required property files defining minimal properties required for a single broker &#x2013; single node cluster.</p></div></div><p>The important properties defined in<a id="id37" class="indexterm"/> <code class="literal">zookeeper.properties</code> are shown in the following code:</p><div class="informalexample"><pre class="programlisting"># Data directory where the zookeeper snapshot is stored.
dataDir=/tmp/zookeeper

# The port listening for client request
clientPort=2181</pre></div><p>By default, the ZooKeeper server will listen on <code class="literal">*:2181/tcp</code>. For detailed information on how to set up <a id="id38" class="indexterm"/>multiple servers of ZooKeeper, visit <a class="ulink" href="http://zookeeper.apache.org/">http://zookeeper.apache.org/</a>.</p></div><div class="section" title="Starting the Kafka broker"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec10"/>Starting the Kafka broker</h2></div></div></div><p>Now start the Kafka <a id="id39" class="indexterm"/>broker using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]# bin/kafka-server-start.sh config/server.properties</strong></span>
</pre></div><p>You should now see the output as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7938OS_03_03.jpg" alt="Starting the Kafka broker"/></div><p>
<code class="literal">server.properties</code> defines the <a id="id40" class="indexterm"/>following important properties required for the Kafka broker:</p><div class="informalexample"><pre class="programlisting"># The id of the broker. This must be set to a unique integer for each broker.
Broker.id=0

# The directory under which to store log files
log.dir=/tmp/kafka8-logs

# Zookeeper connection string 
zookeeper.connect=localhost:2181</pre></div><p>The last section in this chapter defines few more important properties available for the Kafka broker. For a complete list of Kafka broker properties<a id="id41" class="indexterm"/>, visit <a class="ulink" href="http://kafka.apache.org/documentation.html#brokerconfigs">http://kafka.apache.org/documentation.html#brokerconfigs</a>.</p></div><div class="section" title="Creating a Kafka topic"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec11"/>Creating a Kafka topic</h2></div></div></div><p>Kafka provides a <a id="id42" class="indexterm"/>command-line utility for creating topics on the Kafka server. Let's create a topic named <code class="literal">kafkatopic</code> with a single partition and only one replica using this utility:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]# bin/kafka-create-topic.sh --zookeeper localhost:2181 --replica 1 --partition 1 --topic kafkatopic</strong></span>
</pre></div><p>You should get an output as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7938OS_03_04.jpg" alt="Creating a Kafka topic"/></div><p>The previously mentioned utility will create a topic and show the successful creation message as shown in the previous screenshot.</p></div><div class="section" title="Starting a producer for sending messages"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec12"/>Starting a producer for sending messages</h2></div></div></div><p>Kafka provides<a id="id43" class="indexterm"/> users with a command-line producer client that accepts inputs from the command line and publishes them as a message to the Kafka cluster. By default, each new line entered is considered as a new message. The following command is used to start the console-based producer for sending the messages</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]# bin/kafka-console-producer.sh --broker-list localhost:9092 --topic kafkatopic</strong></span>
</pre></div><p>You should see an output as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7938OS_03_05.jpg" alt="Starting a producer for sending messages"/></div><p>While starting the producer's command-line client, the following parameters are required:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">broker-list</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">topic</code></li></ul></div><p>
<code class="literal">broker-list</code> specifies<a id="id44" class="indexterm"/> the brokers to be connected as <code class="literal">&lt;node_address:port&gt;</code>, that is, <code class="literal">localhost:9092</code>. The topic <code class="literal">Kafkatopic</code> is a topic that was created in the <span class="emphasis"><em>Creating a Kafka topic</em></span> section. The topic name is required for sending a message to a specific group of consumers.</p><p>Now type the following message, <code class="literal">This is single broker</code>, and press <span class="emphasis"><em>Enter</em></span>. You should see an output as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7938OS_03_06.jpg" alt="Starting a producer for sending messages"/></div><p>Try some more messages.</p><p>Detailed information about how to write producers for Kafka and producer properties will be <a id="id45" class="indexterm"/>discussed in <a class="link" href="ch05.html" title="Chapter&#xA0;5.&#xA0;Writing Producers">Chapter 5</a>, <span class="emphasis"><em>Writing Producers</em></span>.</p></div><div class="section" title="Starting a consumer for consuming messages"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec13"/>Starting a consumer for consuming messages</h2></div></div></div><p>Kafka also <a id="id46" class="indexterm"/>provides a command-line consumer client for message consumption. The following command is used for starting the console-based consumer that shows output at command line as soon as it subscribes to the topic created in Kafka broker:</p><div class="informalexample"><pre class="programlisting"> [root@localhost kafka-0.8]# bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic kafkatopic  --from-beginning </pre></div><p>On execution of the previous command, you should get an output as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7938OS_03_07(2).jpg" alt="Starting a consumer for consuming messages"/></div><p>The default properties for the consumer are defined in <code class="literal">consumer.properties</code>. The important properties are:</p><div class="informalexample"><pre class="programlisting"># consumer group id (A string that uniquely identifies a set of consumers # within the same consumer group)
groupid=test-consumer-group

# zookeeper connection string
zookeeper.connect=localhost:2181</pre></div><p>Detailed information about how to write consumers for Kafka and consumer properties is discussed in <a class="link" href="ch06.html" title="Chapter&#xA0;6.&#xA0;Writing Consumers">Chapter 6</a>, <span class="emphasis"><em>Writing Consumers</em></span>.</p><p>By running all four components (<code class="literal">zookeeper</code>, <code class="literal">broker</code>, <code class="literal">producer</code>, and <code class="literal">consumer</code>) in different terminals, you will be able to enter messages from the producer's terminal and see them appearing in the subscribed consumer's terminal.</p><p>Usage information for both producer and consumer command-line tools can be viewed by running the<a id="id47" class="indexterm"/> command with no arguments.</p></div></div></div></body></html>
