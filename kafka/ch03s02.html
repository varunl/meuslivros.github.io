<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Single node &#x2013; multiple broker cluster</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="section" title="Single node &#x2013; multiple broker cluster"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec14"/>Single node &#x2013; multiple broker cluster</h1></div></div></div><p>Now we have <a id="id48" class="indexterm"/>come to the next level of Kafka cluster. Let us now set up single node &#x2013; multiple broker based Kafka cluster as shown in the following diagram:</p><div class="mediaobject"><img src="graphics/7938OS_03_07.jpg" alt="Single node &#x2013; multiple broker cluster"/></div><div class="section" title="Starting ZooKeeper"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec14"/>Starting ZooKeeper</h2></div></div></div><p>The first step of<a id="id49" class="indexterm"/> starting ZooKeeper remains the same for this type of cluster.</p></div><div class="section" title="Starting the Kafka broker"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec15"/>Starting the Kafka broker</h2></div></div></div><p>For setting up multiple <a id="id50" class="indexterm"/>brokers on a single node, different server property files are required for each broker. Each property file will define unique, different values for the following properties:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">brokerid</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">port</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">log.dir</code></li></ul></div><p>For example, in <code class="literal">server-1.properties</code> used for <code class="literal">broker1</code>, we define the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">brokerid=1</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">port=9092</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">log.dir=/tmp/kafka8-logs/broker1</code></li></ul></div><p>Similarly, for <code class="literal">server-2.properties</code> used for <code class="literal">broker2</code>, we define the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">brokerid=2</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">port=9093</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">log.dir=/tmp/kafka8-logs/broker2</code></li></ul></div><p>A similar procedure is followed for all brokers. Now, we start each broker in a separate console using the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]# env JMX_PORT=9999 bin/kafka-server-start.sh config/server-1.properties</strong></span>
<span class="strong"><strong>[root@localhost kafka-0.8]# env JMX_PORT=10000 bin/kafka-server-start.sh config/server-2.properties</strong></span>
</pre></div><p>Similar <a id="id51" class="indexterm"/>commands are used for all brokers You will also notice that we have defined a separate JMX port for each broker.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>The JMX ports are used for optional monitoring and troubleshooting with tools such as <a id="id52" class="indexterm"/>JConsole.</p></div></div></div><div class="section" title="Creating a Kafka topic"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec16"/>Creating a Kafka topic</h2></div></div></div><p>Using the command-line<a id="id53" class="indexterm"/> utility for creating topics on the Kafka server, let's create a topic named <code class="literal">othertopic</code> with two partitions and two replicas:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]# bin/kafka-create-topic.sh --zookeeper localhost:2181 --replica 2 --partition 2 --topic othertopic</strong></span>
</pre></div></div><div class="section" title="Starting a producer for sending messages"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec17"/>Starting a producer for sending messages</h2></div></div></div><p>If we use a single <a id="id54" class="indexterm"/>producer to get connected to all the brokers, we need to pass the initial list of brokers, and the information of the remaining brokers is identified by querying the broker passed within <code class="literal">broker-list</code>, as shown in the following command. This metadata information is based on the topic name.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>--broker-list localhost:9092,localhost:9093</strong></span>
</pre></div><p>Use the following command to start the producer:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]# bin/kafka-console-producer.sh --broker-list localhost:9092,localhost:9093 --topic othertopic</strong></span>
</pre></div><p>If we have a <a id="id55" class="indexterm"/>requirement to run multiple producers connecting to different combinations of brokers, we need to specify the broker list for each producer like we did in the case of multiple brokers.</p></div><div class="section" title="Starting a consumer for consuming messages"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec18"/>Starting a consumer for consuming messages</h2></div></div></div><p>The same <a id="id56" class="indexterm"/>consumer client, as in the previous example, will be used in this process. Just as before, it shows the output on the command line as soon as it subscribes to the topic created in the Kafka broker:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]# bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic othertopic  --from-beginning </strong></span>
</pre></div></div></div></body></html>
