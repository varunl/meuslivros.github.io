<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter&#xA0;2.&#xA0;Installing Kafka</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="chapter" title="Chapter&#xA0;2.&#xA0;Installing Kafka"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter&#xA0;2.&#xA0;Installing Kafka</h1></div></div></div><p>Kafka is an Apache project and its <a id="id15" class="indexterm"/>current Version 0.7.2 is available as a stable release. Kafka Version 0.8 is available as beta release, which is gaining acceptance in many large-scale enterprises. Kafka 0.8 offers many advanced features compared to 0.7.2. A few of its advancements are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Prior to 0.8, any unconsumed partition of data within the topic could be lost if the broker failed. Now the partitions are provided with a replication factor. This ensures that any committed message would not be lost, as at least one replica is available.</li><li class="listitem" style="list-style-type: disc">The previous feature also ensures that all the producers and consumers are replication aware. By default, the producer's message send request is blocked until the message is committed to all active replicas; however, producers can also be configured to commit messages to a single broker.</li><li class="listitem" style="list-style-type: disc">Like Kafka producers, Kafka consumers' polling model changes to a long pulling model and gets blocked until a committed message is available from the producer, which avoids frequent pulling.</li><li class="listitem" style="list-style-type: disc">Additionally, Kafka 0.8 also comes with a set of administrative tools, such as controlled shutdown of cluster and Lead replica election tool, for managing the Kafka cluster.</li></ul></div><p>The major limitation is that Kafka Version 0.7.x can't just be replaced by Version 0.8, as it is not backward compatible. If the existing Kafka cluster is based on 0.7.x, a migration tool is provided for migrating the data from the Kafka 0.7.x-based cluster to the 0.8-based cluster. This migration tool actually works as a consumer for 0.7.x-based Kafka clusters and republishes the messages as a producer to Kafka 0.8-based clusters. The following diagram explains this migration:</p><div class="mediaobject"><img src="graphics/7938OS_02_01.jpg" alt="Installing Kafka"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>More information about Kafka <a id="id16" class="indexterm"/>migration from 0.7.x to 0.8 can be found at <a class="ulink" href="https://cwiki.apache.org/confluence/display/KAFKA/Migrating+from+0.7+to+0.8">https://cwiki.apache.org/confluence/display/KAFKA/Migrating+from+0.7+to+0.8</a>.</p></div></div><p>Coming back to installing Kafka, as a first step, we need to download the available stable/beta release (all the commands are tested on CentOS 5.5 OS and may differ on other kernel-based OS).</p><div class="section" title="Installing Kafka"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec11"/>Installing Kafka</h1></div></div></div><p>Now let us see what steps need to be <a id="id17" class="indexterm"/>followed in order to install Kafka:</p><div class="section" title="Downloading Kafka"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec06"/>Downloading Kafka</h2></div></div></div><p>Perform the following steps for <a id="id18" class="indexterm"/>downloading Kafka release 0.7.x:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download the current stable version of Kafka (0.7.2) into a folder on your file system (for example, <code class="literal">/opt</code>) using the following command:<div class="informalexample"><pre class="programlisting">[root@localhost opt]#wget https://www.apache.org/dyn/closer.cgi/incubator/kafka/kafka-0.7.2-incubating/kafka-0.7.2-incubating-src.tgz  </pre></div></li><li class="listitem">Extract the downloaded <code class="literal">kafka-0.7.2-incubating-src.tgz</code> using the following command:<div class="informalexample"><pre class="programlisting">[root@localhost opt]# tar xzf kafka-0.7.2-incubating-src.tgz</pre></div></li></ol></div><p>Perform the following steps for <a id="id19" class="indexterm"/>downloading Kafka release 0.8:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download the current beta release of Kafka (0.8) into a folder on your filesystem (for example, <code class="literal">/opt</code>) using the following command:<div class="informalexample"><pre class="programlisting">[root@localhost opt]#wget 
https://dist.apache.org/repos/dist/release/kafka/kafka-0.8.0-beta1-src.tgz</pre></div></li><li class="listitem">Extract the <a id="id20" class="indexterm"/>downloaded <code class="literal">kafka-0.8.0-beta1-src.tgz</code> using the following command:<div class="informalexample"><pre class="programlisting">[root@localhost opt]# tar xzf kafka-0.8.0-beta1-src.tgz</pre></div></li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>Going forward, all commands in this chapter are <a id="id21" class="indexterm"/>same for both the versions (0.7.x and 0.8) of Kafka.</p></div></div></div><div class="section" title="Installing the prerequisites"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec07"/>Installing the prerequisites</h2></div></div></div><p>Kafka is implemented in Scala and <a id="id22" class="indexterm"/>uses the <code class="literal">./sbt</code> tool for building Kafka binaries. <span class="strong"><strong>sbt</strong></span> is a build tool for Scala and Java projects which requires Java 1.6 or later.</p><div class="section" title="Installing Java 1.6 or later"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec02"/>Installing Java 1.6 or later</h3></div></div></div><p>Perform the following steps for <a id="id23" class="indexterm"/>installing Java 1.6 or later:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download the <code class="literal">jdk-6u45-linux-x64.bin</code> link from Oracle's website: <a class="ulink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a>.</li><li class="listitem">Make sure the file is executable:<div class="informalexample"><pre class="programlisting">[root@localhost opt]#chmod +x jdk-6u45-linux-x64.bin </pre></div></li><li class="listitem">Run the installer:<div class="informalexample"><pre class="programlisting">[root@localhost opt]#./jdk-6u45-linux-x64.bin </pre></div></li><li class="listitem">Finally, add the environment variable <code class="literal">JAVA_HOME</code>. The following command will write the <code class="literal">JAVA_HOME</code> environment variable to the file <code class="literal">/etc/profile</code>, which contains system-wide environment configuration:<div class="informalexample"><pre class="programlisting">[root@localhost opt]# echo "export JAVA_HOME=/usr/java/jdk1.6.0_45" &gt;&gt; /etc/profile</pre></div></li></ol></div></div></div><div class="section" title="Building Kafka"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec08"/>Building Kafka</h2></div></div></div><p>The following steps need to be <a id="id24" class="indexterm"/>followed for building and packaging Kafka:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Change the current directory to the downloaded Kafka directory by using the following command:<div class="informalexample"><pre class="programlisting">[root@localhost opt]# cd kafka-&lt;VERSION&gt;</pre></div></li><li class="listitem">The directory structure for Kafka 0.8 looks as follows:<div class="mediaobject"><img src="graphics/7938OS_02_02.jpg" alt="Building Kafka"/></div></li><li class="listitem">The following command downloads all the dependencies such as Scala compiler, Scala libraries, <a id="id25" class="indexterm"/>Zookeeper, Core-Kafka update, and Hadoop consumer/producer update, for building Kafka:<div class="informalexample"><pre class="programlisting">[root@localhost opt]#./sbt update</pre></div><p>On execution of the previous command, you should see the following output on the command prompt:</p><div class="mediaobject"><img src="graphics/7938OS_02_03.jpg" alt="Building Kafka"/></div></li><li class="listitem">Finally, compile the complete source code for Core-Kafka, Java examples, and Hadoop producer/consumer, <a id="id26" class="indexterm"/>and package them into JAR files using the following command:<div class="informalexample"><pre class="programlisting">[root@localhost opt]#./sbt package</pre></div><p>On execution of the previous command, you should see the following output on the command prompt:</p><div class="mediaobject"><img src="graphics/7938OS_02_04.jpg" alt="Building Kafka"/></div></li><li class="listitem">The following additional command is only needed with Kafka 0.8 for producing the dependency artifacts:<div class="informalexample"><pre class="programlisting">[root@localhost opt]#./sbt assembly-package-dependency</pre></div><p>On execution of the previous command, you should see the following output on the command prompt:</p><div class="mediaobject"><img src="graphics/7938OS_02_05.jpg" alt="Building Kafka"/></div></li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>If you are planning to play with <a id="id27" class="indexterm"/>Kafka 0.8, you may experience lot of warnings with update and package commands, which can be ignored.</p></div></div></div></div></div></body></html>
