<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter&#xA0;8.&#xA0;Kafka Tools</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="chapter" title="Chapter&#xA0;8.&#xA0;Kafka Tools"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter&#xA0;8.&#xA0;Kafka Tools</h1></div></div></div><p>In this last chapter, we will be exploring tools available in Kafka and its integration with third-party tools. We will also be discussing in brief the work taking place in the area of performance testing of Kafka.</p><p>The main focus areas for this chapter are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Kafka administration tools</li><li class="listitem" style="list-style-type: disc">Integration with other tools</li><li class="listitem" style="list-style-type: disc">Kafka performance testing</li></ul></div><div class="section" title="Kafka administration tools"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec36"/>Kafka administration tools</h1></div></div></div><p>There <a id="id222" class="indexterm"/>are a number of tools or utilities provided by Kafka 0.8 to administrate features such as replication and topic creation. Let's have a quick look at these tools.</p><div class="section" title="Kafka topic tools"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec40"/>Kafka topic tools</h2></div></div></div><p>By <a id="id223" class="indexterm"/>default, <a id="id224" class="indexterm"/>Kafka creates the topic with a default number of partitions and replication factor (the default value is <code class="literal">1</code> for both). But in real-life scenarios, we may need to define the number of partitions and replication factors more than once.</p><p>The following is the command for creating the topic with specific parameters:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]# bin/kafka-create-topic.sh --zookeeper localhost:2181 --replica 3 --partition 2 --topic kafkatopic</strong></span>
</pre></div><p>Kafka also provides the utility for finding out the list of topics within the Kafka server. The List Topic tool<a id="id225" class="indexterm"/> provides the listing of topics and information about their partitions, replicas, or leaders by querying ZooKeeper.</p><p>The following is the command for obtaining the list of topics:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]#bin/kafka-list-topic.sh --zookeeper localhost:2181</strong></span>
</pre></div><p>On execution of the above command, you should get an output as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7938OS_08_01.jpg" alt="Kafka topic tools"/></div><p>The above console output shows that we can get the information about the topic and partitions that have replicated data. The output from the previous screenshot can be explained as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">leader</code> is a randomly selected node for a specific portion of the partitions and is responsible for all reads and writes for this partition</li><li class="listitem" style="list-style-type: disc"><code class="literal">replicas</code> represents the list of nodes that holds the log for a specified partition</li><li class="listitem" style="list-style-type: disc"><code class="literal">isr</code> represents the subset of in-sync replicas' list that is currently alive and in sync with the leader</li></ul></div><p>Note that <code class="literal">kafkatopic</code> has<a id="id226" class="indexterm"/> two partitions (partitions <code class="literal">0</code> and <code class="literal">1</code>) with three replications, whereas <code class="literal">othertopic</code> has just one partition with two replications.</p></div><div class="section" title="Kafka replication tools"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec41"/>Kafka replication tools</h2></div></div></div><p>For <a id="id227" class="indexterm"/>better management of replication <a id="id228" class="indexterm"/>features, Kafka provides tools for selecting a replica lead and controlling shut down of brokers.</p><p>As we have learned from Kafka design, in replication, multiple partitions can have replicated data, and out of these multiple replicas, one replica acts as a lead, and the rest of the replicas act as in-sync followers of the lead replica. In case of non-availability of a lead replica, maybe due to broker shutdown, a new lead replica needs to be selected.</p><p>For scenarios <a id="id229" class="indexterm"/>such as shutting down of the Kafka broker for maintenance activity, election of the new leader is done sequentially, and this causes significant read/write operations at ZooKeeper. In any big cluster with many topics/partitions, sequential election of lead replicas causes delay in availability. </p><p>To ensure high availability, Kafka provides tools for a controlled shutdown of Kafka brokers. If the broker has the lead partition shut down, this tool transfers the leadership proactively to other in-sync replicas on another broker. If there is no in-sync replica available, the tool will fail to shut down the broker in order to ensure no data is lost.</p><p>The following is the format for using this tool:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]# bin/kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper &lt;zookeeper_host:port/namespace&gt; --broker &lt;brokerID&gt;</strong></span>
</pre></div><p>The ZooKeeper<a id="id230" class="indexterm"/> host and the broker ID that need to be shut down are mandatory parameters. We can also specify the number of retries (<code class="literal">--num.retries</code>, default value <code class="literal">0</code>) and retry interval in milliseconds (<code class="literal">--retry.interval.ms</code>, default value <code class="literal">1000</code>) with a controlled shutdown tool.</p><p>Next, in any big Kafka cluster with many brokers and topics, Kafka ensures that the lead replicas for partitions are equally distributed among the brokers. However, in case of shutdown (controlled as well) or broker failure, this equal distribution of lead replicas may get imbalanced within the cluster.</p><p>Kafka provides a tool that is used to maintain the balanced distribution of lead replicas within the Kafka cluster across available brokers.</p><p>The following is the format for using this tool:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[root@localhost kafka-0.8]# bin/kafka-preferred-replica-election.sh --zookeeper &lt;zookeeper_host:port/namespace&gt;</strong></span>
</pre></div><p>This tool retrieves all the topic partitions for the cluster from ZooKeeper. We can also provide the list of topic partitions in a JSON file format. It works asynchronously to update the ZooKeeper path for moving the leader of partitions and to create a balanced distribution.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note25"/>Note</h3><p>For detailed explanation on <a id="id231" class="indexterm"/>Kafka tools and their usage, please refer to <a class="ulink" href="https://cwiki.apache.org/confluence/display/KAFKA/Replication+tools">https://cwiki.apache.org/confluence/display/KAFKA/Replication+tools</a>.</p></div></div></div></div></div></body></html>
